# Shaykhutdinov_YNBO_07_24_Practic2

Инструмент командной строки для анализа и визуализации графа зависимостей пакетов Alpine Linux. Скрипт загружает индекс репозитория (`APKINDEX`), строит граф зависимостей для указанного пакета и выводит его в формате Mermaid и ASCII-дерева.

## Особенности

- **Автономная работа**: Не требует установленного Alpine Linux или утилиты `apk`. Работает напрямую с `APKINDEX.tar.gz`.
- **Визуализация**:
  - Генерация кода для диаграмм [Mermaid](https://mermaid.js.org/).
  - Генерация текстового ASCII-дерева зависимостей.
- **Фильтрация**: Автоматически очищает граф от системных библиотек (`so:libc.so.6`, `scanelf` и т.д.), оставляя только пакетные зависимости.
- **Демонстрация**: Автоматически находит и показывает примеры графов для трех случайных пакетов из репозитория, имеющих зависимости.

## Требования

- **Python 3.11+** (необходим встроенный модуль `tomllib`).
- Интернет-соединение для загрузки `APKINDEX`.

### Зависимости Python

Установите необходимые библиотеки:

```bash
pip install requests
```

## Настройка

Перед запуском необходимо создать или отредактировать файл конфигурации `pr2.toml` в той же директории, где находится скрипт.

Пример файла `pr2.toml`:

```toml
title = "acf-apk-tools"   # Имя пакета для анализа
url = "https://dl-cdn.alpinelinux.org/alpine/v3.22/main/x86_64/APKINDEX.tar.gz" # Ссылка на репозиторий
version = "0.11.0-r3"     # Ожидаемая версия пакета
ascii = true              # Включить вывод ASCII-дерева (true/false)
test = true               # Служебный параметр (не влияет на логику визуализации)
```

## Запуск

Запустите скрипт из терминала:

```bash
python pr2.py
```

## Результат работы

Скрипт выполнит следующие действия:

1. **Загрузка**: Скачает и распакует `APKINDEX` в память.
2. **Анализ целевого пакета**:
   - Найдет пакет, указанный в поле `title`.
   - Построит граф зависимостей.
   - Выведет код для диаграммы Mermaid (можно вставить в [Mermaid Live Editor](https://mermaid.live/)).
   - Если `ascii = true`, выведет дерево зависимостей в консоль.
3. **Демонстрация**:
   - Найдет в репозитории 3 случайных пакета, у которых есть непустые зависимости.
   - Выведет их графы для примера.
4. **Сравнение**:
   - Выведет текстовое пояснение о различиях между работой данного скрипта и штатной утилиты `apk info -R` (объяснение фильтрации системных вызовов).

## Детали реализации

- **Парсинг**: Скрипт читает блоки данных из `APKINDEX`, извлекая поля `P:` (Package), `V:` (Version), `D:` (Dependencies) и `p:` (Provides).
- **Очистка зависимостей**:
  - Удаляются операторы версий (`<`, `>`, `=`, `~`).
  - Игнорируются зависимости, начинающиеся с `so:`, `cmd:`, `/` (файловые пути), так как цель — показать связи именно между *пакетами*, а не библиотеками.
- **Разрешение зависимостей**:
  - Если зависимость не найдена по имени пакета, скрипт ищет пакет, который предоставляет эту зависимость через поле `provides`.
